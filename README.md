## Install

    yarn install

After that need to add a _config.js_ file. The example you can find in the _config.example.js_ file.

## Compile contracts

    npx hardhat compile

After compilation, there will be a table that contains information about the sizes of the contracts.

---

## Deploy

Available networks:

-   Ethereum mainnet (`ethereumMainnet`)
-   Ethereum testnets (`ropsten`, `kovan`, `rinkeby`, `goerli`)
-   BSC Mainnet (`bscMainnet`)
-   BSC Testnet (`bscTestnet`)
-   Polygon Mainnet (`polygonMainnet`)
-   Polygon Testnet (`polygonTestnet`)

For using the Ethereum mainnet or testnets, in _config.js_ should be specified the `infuraIdProject` variable.

New networks can be added into file _hardhat.config.ts_ in field `networks`.

Deployment can be done in two ways:

-   Script
-   Deploy plugin

### **Plugin deploy**

To make deployments, script files should be added into folder _deploy/_.

This command will run all these scripts (in alphabetic order) and deploy contracts into network `networkName`:

    npx hardhat deploy --network networkName

To export all information from deployments into pretty view for network `networkName` into new file _output.json_:

    npx hardhat export --export output.json --network bscTestnet

Documentation for this plugin can be found [here](https://github.com/wighawag/hardhat-deploy/tree/master).

### **Script deploy**

Command to deploy the contract into network `networkName`:

    npx hardhat run ./scripts/token-deploy.js --network networkName

This script also will verify the code on the explorer. To enable this, before deployment in _config.js_ should be specified variable `apiKey*` with the API key of a corresponding explorer.

---

## Tests

Command to run all tests:

    npx hardhat test

Command to run specific test file _test-file.js_:

    npx hardhat test ./test/test-file.js

To show logs and calls in tests add `--trace` to the command and to show logs, calls, sloads, and sstores add `--fulltrace` to the command.

After tests, you will see a table that contains information about gas usage. There you will see how many gas functions spend. If you specify the variable `coinmarketcapApi` in _config.js_ and specify the `token` field in the `gasReporter` field in the _hardhat.config.js_ file you will see a cost of the gas in USD.

## Using forks

The hardhat allows to use fork the every chain. For fork from the specific block you need archive node.
The node endpoint and the block number (if need) must be specified in the _hardhat.config.js_ file in field `networks.hardhat.forking`. Also to enable forking in testing, field `enabled` should be true.
You can test forking configuration using following command:

```
npx hardhat test test-fork/token-test.ts
```

## Coverage

This is a plugin that shows how good contracts are covered by tests.

    npm run coverage

The plugin will start tests and after folder _coverage/_ will be generated. In this folder, the file _index.html_ can be opened in a browser and it shows visually where contracts aren't covered by tests.

Also, file _.solcover.js_ is a config for this plugin. In this config ignore files can be specified.

## Prettier

This is a code formatter.

    npm run prettier

File _.prettierrc_ is the config. Information how to write config is [here](https://prettier.io/docs/en/configuration.html).

Also, file _.prettierignore_ specifies all files and folders that are ignored by the plugin.

## Docgen

Docs for smart contracts can be auto-generated by docgen. It uses the NatSpec format.

    npx hardhat docgen

Docs will be generated into the folder _docs/_. Example of NatSpec can be found in file _Token.sol_.

Information how to write NatSpec for smart contracts is [here](https://docs.soliditylang.org/en/latest/natspec-format.html).

## Solhint

Plugin for linting Solidity code. Documentation can be found [here](https://github.com/protofire/solhint).

    npm run solhint

File _.solhint.json_ is the config. Information how to write config is [here](https://github.com/protofire/solhint/blob/master/docs/configuration.md).

Also, file _.solhintignore_ specifies all files and folders that are ignored by the plugin.

## Slither

Static analysis tool ([documentation](https://github.com/crytic/slither)). To run it, the docker should be installed and run.

    docker run -it -v `pwd`:/code  trailofbits/eth-security-toolbox
    cd /code
    slither .

And then exit docker

    exit

File _./slither.config.json_ is a config. Information about config can be found [here](https://github.com/crytic/slither/wiki/Usage#configuration-file).

## Echidna

Smart Contract Fuzzer ([documentation](https://github.com/crytic/echidna)). To run it, the docker should be installed and run.

    docker run -it -v `pwd`:/code  trailofbits/eth-security-toolbox
    cd /code
    solc-select install 0.8.15
    solc-select use 0.8.15
    echidna-test . --contract TokenTest --config ./echidna.config.yml

And then exit docker

    exit

File _./echidna.config.yml_ is a config. Information about config can be found [here](https://github.com/crytic/echidna/blob/master/tests/solidity/basic/default.yaml)(default config) and [here](https://github.com/crytic/echidna/wiki/Config)(parameters description).

---

### Added plugins

-   [**@openzeppelin/contracts@4.7.2**](https://github.com/OpenZeppelin/openzeppelin-contracts/tree/v4.7.2/contracts) - Standard OpenZeppelin's contract library.

-   [**@openzeppelin/contracts-upgradeable@4.7.2**](https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable/tree/v4.7.2) - Standard OpenZeppelin's upgradeable contract library.

-   [**hardhat**](https://hardhat.org/getting-started/) - Solidity development environment.

-   [**hardhat-abi-exporter**](https://hardhat.org/plugins/hardhat-abi-exporter.html) - Exports smart contract ABIs on compilation. It will run automatically on a compilation.

-   [**hardhat-contract-sizer**](https://hardhat.org/plugins/hardhat-contract-sizer.html) - Writes bytecode sizes of smart contracts. It will run automatically on a compilation.

-   [**hardhat-gas-reporter**](https://hardhat.org/plugins/hardhat-gas-reporter.html) - Writes information of gas usage in tests. It will run automatically on tests.

-   [**hardhat-spdx-license-identifier**](https://hardhat.org/plugins/hardhat-spdx-license-identifier.html) - Writes SPDX License Identifier into sol files. It will run automatically on a compilation.

-   [**hardhat-tracer**](https://hardhat.org/plugins/hardhat-tracer.html) - Prints events when running tests.

-   [**solidity-coverage**](https://hardhat.org/plugins/solidity-coverage.html) - Solidity code coverage plugin.

-   [**@nomiclabs/hardhat-etherscan**](https://hardhat.org/plugins/nomiclabs-hardhat-etherscan.html) - Automatic verification on Etherscan, BscScan, and others.

-   [**prettier**](https://www.npmjs.com/package/prettier) - Formatter. Run with script `prettier` of npm.

-   [**solidity-docgen**](https://github.com/OpenZeppelin/solidity-docgen) - Program that extracts documentation for a Solidity project.
